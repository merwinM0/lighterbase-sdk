var o=class{baseURL;tokenProvider;constructor(e,t){if(!e||typeof e!="string")throw new Error("Lighterbase \u521D\u59CB\u5316\u5931\u8D25\uFF1A\u5FC5\u987B\u4F20\u5165\u4E00\u4E2A\u6709\u6548\u7684\u57FA\u51C6 URL \u5B57\u7B26\u4E32\u3002");this.baseURL=e,this.tokenProvider=t??this.defaultBrowserToken}defaultBrowserToken=()=>{if(typeof document>"u")return"";let e=document.cookie.match(/authToken=([^;]*)/);return e&&e[1]?e[1]:""};getAuthToken(){return typeof this.tokenProvider=="function"?this.tokenProvider():this.tokenProvider}async request(e,t,s,a=!1){try{let r=a?"":this.getAuthToken(),u=`${this.baseURL}/api/auto/${t}`,i={"Content-Type":"application/json"};r&&(i.Authorization=`Bearer ${r}`);let c={method:e,headers:i};s&&e!=="GET"&&(c.body=JSON.stringify(s));let n=await fetch(u,c);if(!n.ok){let p=await n.json().catch(()=>({message:""}));throw new Error(p.message||`API \u8BF7\u6C42\u9519\u8BEF: \u72B6\u6001\u7801 ${n.status}`)}return n.status===204?null:n.json()}catch(r){throw console.error("Lighterbase \u8BF7\u6C42\u5931\u8D25:",r),r}}async insertTable(e,t){let s=t==="users";return this.request("POST",`create/${t}`,e,s)}deleteTable(e,t){return this.request("DELETE",`delete/${t}`,e)}updateTable(e,t){return this.request("PUT",`update/${t}`,e)}searchTable(e,t,s,a){let r=`view/${t}?page=${s}&perpage=${a}`;return this.request("POST",r,e)}};export{o as default};
